# オフライン動作テスト結果

**実施日:** 2025-12-01  
**テスト環境:** 本番ビルド（`pnpm build && pnpm start`）  
**ブラウザ:** Chrome DevTools

---

## テスト項目

### 1. Service Worker登録確認

#### テスト手順
1. `http://localhost:3000` にアクセス
2. Chrome DevTools → Application → Service Workers

#### 結果
- [x] Service Workerが登録されている ✅
- [x] Status: "activated and is running" ✅
- [x] Source: `/sw.js` ✅

**確認日時:** 2025-12-01  
**結果:** Service Workerは正常に登録され、activated状態で動作中

---

### 2. キャッシュ確認

#### テスト手順
1. Chrome DevTools → Application → Cache Storage
2. 各キャッシュの内容を確認

#### 確認項目
- [x] `workbox-precache-v2` - 静的アセットキャッシュ（152エントリ） ✅
- [x] `cross-origin` - 国土地理院ラスタタイルキャッシュ（24エントリ） ✅
- [ ] `geojson-data` - 避難所データキャッシュ（要確認）
- [ ] `static-image-assets` - 画像キャッシュ（要確認）
- [ ] `pages` - ページキャッシュ（要確認）

#### キャッシュサイズ
- `workbox-precache-v2`: 152エントリ（静的アセット）
- `cross-origin`: 24エントリ（地図タイル）
- 合計: 176エントリ（キャッシュサイズは要確認）

**確認日時:** 2025-12-01  
**結果:** キャッシュは正常に構築されている。地図タイルは`cross-origin`キャッシュに保存されている。

---

### 3. オフライン動作テスト

#### テスト手順
1. オンライン状態で地図を表示（キャッシュを構築）
2. 地図をズーム・パンして複数のタイルを読み込む
3. Chrome DevTools → Network → Throttling → Offline に設定
4. ページをリロード（F5）

#### 確認項目
- [ ] ページが正常に表示される（オフラインでも）
- [ ] 地図が表示される（キャッシュされたタイル）
- [ ] 避難所マーカーが表示される（キャッシュされたGeoJSON）
- [ ] オフラインインジケーターが表示される（`OfflineIndicator`コンポーネント）
- [ ] 地図のズーム・パンが動作する（キャッシュされた範囲内）

#### 結果
- ページ表示: ✅ / ❌
- 地図表示: ✅ / ❌
- 避難所マーカー表示: ✅ / ❌
- オフラインインジケーター: ✅ / ❌
- 地図操作: ✅ / ❌

---

### 4. キャッシュヒット率テスト

#### テスト手順
1. Chrome DevTools → Network を開く
2. オンライン状態で地図を操作（ズーム・パン）
3. オフライン状態で同じ操作を繰り返す
4. Network タブでキャッシュヒット率を確認

#### 結果
- オンライン時のリクエスト数: ___
- オフライン時のリクエスト数: ___
- キャッシュヒット率: ___%

---

### 5. パフォーマンステスト

#### テスト手順
1. キャッシュをクリア（Application → Clear storage）
2. オンライン状態で初回ロード時間を測定
3. オフライン状態でロード時間を測定

#### 結果
- 初回ロード時間（オンライン）: ___ 秒
- オフラインロード時間: ___ 秒
- 目標: 5秒以内

---

### 6. エラーハンドリングテスト

#### テスト手順
1. オフライン状態で、キャッシュされていない範囲に移動
2. エラーメッセージが表示されるか確認

#### 結果
- エラーメッセージ表示: ✅ / ❌
- フォールバック動作: ✅ / ❌

---

## 問題点・改善点

### 発見された問題
1. 
2. 
3. 

### 改善提案
1. 
2. 
3. 

---

## 結論

### テスト結果サマリー

#### ✅ 成功項目
1. **Service Worker登録**: 正常に登録され、activated状態で動作中
2. **キャッシュ構築**: 静的アセット（152エントリ）と地図タイル（24エントリ）が正常にキャッシュされている
3. **オンライン動作**: 地図表示、避難所マーカー表示、フィルタ機能が正常に動作

#### ⚠️ 要確認項目
1. **オフライン動作テスト**: 手動でネットワークをOfflineにして確認が必要
2. **キャッシュサイズ**: 実際のサイズ（MB）を確認する必要がある
3. **GeoJSONデータキャッシュ**: `geojson-data`キャッシュの存在を確認する必要がある

### 次のステップ

1. **手動オフライン動作テスト**
   - Chrome DevTools → Network → Throttling → Offline に設定
   - ページをリロードして動作確認
   - 詳細は `.docs/offline-test-guide.md` を参照

2. **キャッシュサイズの確認**
   - Chrome DevTools → Application → Storage → Clear storage で合計サイズを確認
   - 目標: 100MB以下

3. **GeoJSONデータキャッシュの確認**
   - `geojson-data`キャッシュが存在するか確認
   - オフライン時に避難所データが表示されるか確認 

